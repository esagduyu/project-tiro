<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Tiro{% endblock %}</title>
    <link rel="icon" href="/static/favicon.ico" sizes="any">
    <link rel="icon" href="/static/favicon-32.png" type="image/png" sizes="32x32">
    <link id="theme-css" rel="stylesheet" href="/static/themes/papyrus.css?v=42">
    <link rel="stylesheet" href="/static/styles.css?v=42">
    <script>
    // Apply theme before render to prevent flash
    (function() {
        var mode = localStorage.getItem('tiro-mode');
        if (!mode) mode = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', mode);
        var theme = mode === 'dark' ? 'roman-night' : 'papyrus';
        document.getElementById('theme-css').href = '/static/themes/' + theme + '.css?v=42';
    })();
    </script>
</head>
<body>
    <!-- Left sidebar navigation -->
    <nav id="sidebar" class="sidebar">
        <div class="sidebar-brand">
            <a href="/inbox" class="sidebar-logo"><img src="/static/logo-128.png" alt="Tiro" width="28" height="28"></a>
            <span class="sidebar-title">Tiro</span>
        </div>
        <div class="sidebar-nav">
            <button id="save-btn" class="sidebar-item sidebar-save-btn">
                <span class="sidebar-icon">&#43;</span>
                <span class="sidebar-label">Save</span>
            </button>
            <a href="/inbox" class="sidebar-item {% block nav_inbox %}{% endblock %}">
                <span class="sidebar-icon">&#9636;</span>
                <span class="sidebar-label">Inbox</span>
                <span id="unread-badge" class="sidebar-badge" style="display:none;"></span>
            </a>
            <a href="/digest" class="sidebar-item {% block nav_digest %}{% endblock %}">
                <span class="sidebar-icon">&#9673;</span>
                <span class="sidebar-label">Digest</span>
            </a>
            <a href="/graph" class="sidebar-item {% block nav_graph %}{% endblock %}">
                <span class="sidebar-icon">&#9678;</span>
                <span class="sidebar-label">Graph</span>
            </a>
            <a href="/stats" class="sidebar-item {% block nav_stats %}{% endblock %}">
                <span class="sidebar-icon">&#9637;</span>
                <span class="sidebar-label">Stats</span>
            </a>
            <a href="/settings" class="sidebar-item {% block nav_settings %}{% endblock %}">
                <span class="sidebar-icon">&#9881;</span>
                <span class="sidebar-label">Settings</span>
            </a>
        </div>
        <div class="sidebar-footer">
            <button id="theme-toggle" class="sidebar-theme-toggle" title="Toggle dark mode">
                <span class="sidebar-icon">&#9728;</span>
                <span class="sidebar-label" id="theme-label">Light</span>
            </button>
            <a href="https://github.com/esagduyu/project-tiro" target="_blank" rel="noopener" class="sidebar-about">
                <span class="sidebar-icon">&#9432;</span>
                <span class="sidebar-label">About Tiro</span>
            </a>
        </div>
    </nav>

    <!-- Mobile top bar -->
    <header id="mobile-header" class="mobile-header">
        <button id="mobile-menu-btn" class="mobile-menu-btn">&#9776;</button>
        <span class="mobile-brand">Tiro</span>
        <button id="mobile-theme-toggle" class="mobile-theme-toggle">&#9728;</button>
    </header>

    <!-- Sidebar overlay for mobile -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <main class="content {% block content_class %}{% endblock %}">
        {% block content %}{% endblock %}
        <footer class="tiro-footer">
            <span class="tiro-footer-quote">"...without you the oracle was dumb."</span>
            <span class="tiro-footer-attr">â€” Cicero to Tiro, 53 BC</span>
        </footer>
    </main>

    <!-- Save item modal -->
    <div id="save-overlay" class="save-overlay" style="display: none;">
        <div class="save-modal">
            <div class="save-modal-header">
                <h3>Save to Tiro</h3>
                <button id="save-modal-close" class="shortcuts-close">&times;</button>
            </div>
            <div class="save-modal-body">
                <div class="save-tab-row">
                    <button class="save-tab active" data-tab="url">URL</button>
                    <button class="save-tab" data-tab="email">.eml File</button>
                </div>
                <div id="save-tab-url" class="save-tab-content">
                    <input type="text" id="save-url-input" class="save-url-input" placeholder="Paste a URL..." autocomplete="off">
                    <button id="save-url-btn" class="save-submit-btn">Save</button>
                </div>
                <div id="save-tab-email" class="save-tab-content" style="display: none;">
                    <div id="save-drop-zone" class="save-drop-zone">
                        <p class="save-drop-text">Drop .eml file here</p>
                        <p class="save-drop-sub">or <label for="save-file-input" class="save-file-label">choose file</label></p>
                        <input type="file" id="save-file-input" accept=".eml" style="display: none;">
                    </div>
                </div>
                <div id="save-status" class="save-status" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Keyboard shortcuts overlay -->
    <div id="shortcuts-overlay" class="shortcuts-overlay" style="display: none;">
        <div class="shortcuts-modal">
            <div class="shortcuts-header">
                <h3>Keyboard Shortcuts</h3>
                <button id="shortcuts-close" class="shortcuts-close">&times;</button>
            </div>
            <div id="shortcuts-body" class="shortcuts-body"></div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="/static/app.js?v=42"></script>
</body>
</html>
